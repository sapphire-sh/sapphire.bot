{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///external \"puppeteer\"","webpack:///./src/libs/Parser.ts","webpack:///./src/index.ts","webpack:///./src/app.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","require","Parser_Parser","[object Object]","this","shouldProcess","browser","commandQueue","console","log","external_puppeteer_default","a","launch","process","Promise","resolve","setTimeout","command","push","url","context","createIncognitoBrowserContext","page","newPage","goto","waitUntil","selectorQuery","open","elements","$$","length","element","id","type","$$eval","e","textContent","trim","title","link","getAttribute","shift","parse","app","parser","initialize","start","err","error"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 1);\n","module.exports = require(\"puppeteer\");","import puppeteer, {\n\tBrowser,\n\tPage,\n} from 'puppeteer';\n\nimport {\n\tCommand,\n} from '../models';\n\nexport class Parser {\n\tprivate shouldProcess: boolean = false;\n\tprivate browser: Browser = null;\n\tprivate commandQueue: Command[] = [];\n\n\tpublic async initialize() {\n\t\tconsole.log('parser initialize');\n\n\t\tthis.browser = await puppeteer.launch();\n\t\tthis.shouldProcess = true;\n\t}\n\n\tpublic async start() {\n\t\tconsole.log('parser start');\n\n\t\twhile(this.shouldProcess) {\n\t\t\tawait this.process();\n\n\t\t\tawait new Promise((resolve) => {\n\t\t\t\tsetTimeout(resolve, 1000);\n\t\t\t});\n\t\t}\n\t}\n\n\tpublic push(command: Command) {\n\t\tthis.commandQueue.push(command);\n\t}\n\n\tprivate async open(url: string): Promise<Page> {\n\t\tconsole.log(`open: ${url}`);\n\n\t\tconst context = await this.browser.createIncognitoBrowserContext();\n\n\t\tconst page = await context.newPage();\n\t\tawait page.goto(url, {\n\t\t\t'waitUntil': 'networkidle2',\n\t\t});\n\n\t\treturn page;\n\t}\n\n\tprivate async parse(command: Command) {\n\t\tconsole.log('parse');\n\n\t\tconst {\n\t\t\turl,\n\t\t\tselectorQuery,\n\t\t} = command;\n\n\t\tconst page = await this.open(url);\n\n\t\tconst elements = await page.$$(selectorQuery);\n\t\tconsole.log(elements.length);\n\n\t\tfor(const element of elements) {\n\t\t\tconst [\n\t\t\t\tid,\n\t\t\t\ttype,\n\t\t\t] = await element.$$eval('td', (e) => {\n\t\t\t\treturn [\n\t\t\t\t\te[0].textContent.trim(),\n\t\t\t\t\te[1].textContent.trim(),\n\t\t\t\t];\n\t\t\t});\n\n\t\t\tconst [\n\t\t\t\ttitle,\n\t\t\t\tlink,\n\t\t\t] = await element.$$eval('td a', (e) => {\n\t\t\t\treturn [\n\t\t\t\t\te[1].getAttribute('href'),\n\t\t\t\t\te[1].textContent.trim(),\n\t\t\t\t];\n\t\t\t});\n\n\t\t\tconsole.log({\n\t\t\t\tid,\n\t\t\t\ttype,\n\t\t\t\ttitle,\n\t\t\t\tlink,\n\t\t\t});\n\t\t}\n\t}\n\n\tprivate async process() {\n\t\tconsole.log(`parser process ${this.commandQueue.length}`);\n\t\tif(this.shouldProcess === false) {\n\t\t\treturn;\n\t\t}\n\t\tif(this.browser === null) {\n\t\t\treturn;\n\t\t}\n\t\tif(this.commandQueue.length === 0) {\n\t\t\treturn;\n\t\t}\n\n\t\tconst command = this.commandQueue.shift();\n\t\tawait this.parse(command);\n\t}\n}\n","import {\n\tApp,\n} from './app';\n\nconst app = new App();\n(async () => {\n\ttry {\n\t\tawait app.start();\n\t}\n\tcatch(err) {\n\t\tconsole.error(err);\n\t}\n})();\n","import {\n\tParser,\n} from './libs';\n\nimport {\n\tCommand,\n} from './models';\n\nexport class App {\n\tprivate parser: Parser;\n\n\tconstructor() {\n\t\tthis.parser = new Parser();\n\t}\n\n\tpublic async start() {\n\t\tconsole.log('app start');\n\n\t\tawait this.parser.initialize();\n\t\tthis.parser.start();\n\n\t\tconst command: Command = {\n\t\t\t'selectorQuery': 'table.board_list_table tr.table_body:not(.notice)',\n\t\t\t'url': 'http://bbs.ruliweb.com/news/board/1020',\n\t\t};\n\n\t\tthis.parser.push(command);\n\t}\n}\n"],"sourceRoot":""}